<div class="report-container">
  <mat-card>
    <div class="header">
      <div class="title">
        <h2>Relatório de Diárias</h2>
        <p>Listagem detalhada de todos os lançamentos de diárias</p>
      </div>
    </div>
    <hr>

    <div class="filter-row">
      <div class="filter-col filter-col-small">
        <mat-form-field appearance="outline">
          <mat-label>Data Inicial</mat-label>
          <input matInput [matDatepicker]="startPicker" [(ngModel)]="dataInicio">
          <mat-datepicker-toggle matIconSuffix [for]="startPicker"></mat-datepicker-toggle>
          <mat-datepicker #startPicker></mat-datepicker>
        </mat-form-field>
      </div>

      <div class="filter-col filter-col-small">
        <mat-form-field appearance="outline">
          <mat-label>Data Final</mat-label>
          <input matInput [matDatepicker]="endPicker" [(ngModel)]="dataFim">
          <mat-datepicker-toggle matIconSuffix [for]="endPicker"></mat-datepicker-toggle>
          <mat-datepicker #endPicker></mat-datepicker>
        </mat-form-field>
      </div>

      <div class="filter-col filter-col-large">
        <app-collaborator-search 
          [collaborators]="colaboradores"
          label="Colaborador"
          (collaboratorSelected)="onCollaboratorChange($event)">
        </app-collaborator-search>
      </div>

      <div class="filter-col">
        <mat-form-field appearance="outline">
          <mat-label>Posto</mat-label>
          <mat-select [(ngModel)]="postoSelecionado" (selectionChange)="applyFilters()" [compareWith]="compareById">
            <mat-option [value]="null" selected>Todos</mat-option>
            <mat-option *ngFor="let p of postos" [value]="p.id">{{p.nome}}</mat-option>
          </mat-select>
          <mat-icon matPrefix>location_on</mat-icon>
        </mat-form-field>
      </div>
    </div>

    <div class="filter-row">
      <div class="btn-col">
        <button mat-raised-button color="primary" class="add-btn" (click)="consultar()" [disabled]="isLoading">
          <mat-icon>search</mat-icon>
          {{ isLoading ? 'Consultando...' : 'Consultar' }}
        </button>
      </div>
    </div>

    <div class="table-section" *ngIf="showResults">
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Código</th>
              <th>Data</th>
              <th>Colaborador</th>
              <th>Valor (R$)</th>
              <th>Posto</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let row of getPaginatedData()">
              <td>{{row.codigo}}</td>
              <td>{{row.data | date:'dd/MM/yyyy'}}</td>
              <td>{{row.colaborador}}</td>
              <td style="text-align: right;">{{row.valor | number:'1.2-2'}}</td>
              <td>{{row.posto}}</td>
            </tr>
          </tbody>
        </table>
        <mat-paginator [pageSizeOptions]="[10, 25, 50, 100]" [length]="dataSource?.data?.length" 
                       [pageSize]="pageSize" (page)="onPageChange($event)" showFirstLastButtons>
        </mat-paginator>
      </div>

      <!-- Mensagem vazia -->
      <div *ngIf="dataSource?.data?.length === 0" style="padding: 40px 20px; text-align: center; color: #999;">
        <p>Nenhum registro encontrado para o período selecionado.</p>
      </div>
    </div>

    <div *ngIf="!showResults" style="padding: 20px; text-align: center; color: #999;">
      <p>Selecione um período e clique em "Consultar" para visualizar os registros.</p>
    </div>
  </mat-card>
</div>
